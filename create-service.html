<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Post a new service on Student Sphere">
  <title>Post a Service - Student Sphere</title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold fs-4" href="index.html">
        <i class="bi bi-cash-coin"></i> Student Sphere
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="browse.html">Browse</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="create-service.html">Post Service</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="profile.html">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">Login</a>
          </li>
          <li class="nav-item">
            <a class="btn btn-light btn-sm ms-2" href="signup.html">Sign Up</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="py-5 bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm">
            <div class="card-body p-4 p-md-5">
              <h1 class="fw-bold mb-4">Post a New Service</h1>
              
              <form id="createServiceForm" onsubmit="handleCreateService(event)">
                <!-- Service Title -->
                <div class="mb-4">
                  <label for="title" class="form-label fw-semibold">Service Title</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="title" 
                    placeholder="e.g., Python Programming Tutoring"
                    required>
                </div>
                
                <!-- Description -->
                <div class="mb-4">
                  <label for="description" class="form-label fw-semibold">Description</label>
                  <textarea 
                    class="form-control" 
                    id="description" 
                    rows="6"
                    placeholder="Describe your service in detail..."
                    required></textarea>
                  <div class="form-text">Be specific about what you offer and what makes your service unique.</div>
                </div>
                
                <!-- Category and Price -->
                <div class="row mb-4">
                  <div class="col-md-6 mb-3 mb-md-0">
                    <label for="category" class="form-label fw-semibold">Category</label>
                    <select class="form-select" id="category" required>
                      <option value="">Select a category</option>
                      <option value="tutoring">Tutoring</option>
                      <option value="tech">Tech</option>
                      <option value="beauty">Beauty</option>
                      <option value="food">Food</option>
                      <option value="transport">Transport</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="price" class="form-label fw-semibold">Price (ZAR)</label>
                    <div class="input-group">
                      <span class="input-group-text">R</span>
                      <input 
                        type="number" 
                        class="form-control" 
                        id="price" 
                        placeholder="150"
                        min="0"
                        required>
                    </div>
                  </div>
                </div>
                
                <!-- University -->
                <div class="mb-4">
                  <label for="university" class="form-label fw-semibold">University</label>
                  <select class="form-select" id="university" required>
                    <option value="">Select your university</option>
                  </select>
                </div>
                
                <!-- Payment Methods -->
                <div class="mb-4">
                  <label class="form-label fw-semibold d-block mb-3">Payment Methods Accepted</label>
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="Cash" id="paymentCash">
                    <label class="form-check-label" for="paymentCash">
                      <i class="bi bi-cash me-2"></i> Cash
                    </label>
                  </div>
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="EFT" id="paymentEFT">
                    <label class="form-check-label" for="paymentEFT">
                      <i class="bi bi-bank me-2"></i> EFT / Bank Transfer
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Card" id="paymentCard">
                    <label class="form-check-label" for="paymentCard">
                      <i class="bi bi-credit-card me-2"></i> Card Payment
                    </label>
                  </div>
                </div>
                
                <!-- Phone Number -->
                <div class="mb-4">
                  <label for="phone" class="form-label fw-semibold">WhatsApp Number</label>
                  <div class="input-group">
                    <span class="input-group-text">+27</span>
                    <input 
                      type="tel" 
                      class="form-control" 
                      id="phone" 
                      placeholder="821234567"
                      pattern="[0-9]{9}"
                      required>
                  </div>
                  <div class="form-text">Enter your number without the leading 0 (e.g., 821234567)</div>
                </div>
                
                <!-- Image Upload -->
                <div class="mb-4">
                  <label for="image" class="form-label fw-semibold">Service Image</label>
                  <div class="upload-zone" onclick="document.getElementById('image').click()">
                    <i class="bi bi-cloud-upload text-muted mb-3" style="font-size: 3rem;"></i>
                    <p class="mb-2">
                      <span class="text-primary fw-semibold">Click to upload</span> or drag and drop
                    </p>
                    <p class="text-muted small mb-0">PNG, JPG up to 10MB</p>
                    <input 
                      type="file" 
                      class="d-none" 
                      id="image" 
                      accept="image/*"
                      onchange="handleImageUpload(event)">
                  </div>
                  <div id="imagePreview" class="mt-3" style="display: none;">
                    <img id="previewImg" src="" alt="Preview" class="img-fluid rounded" style="max-height: 200px;">
                    <button type="button" class="btn btn-sm btn-danger mt-2" onclick="clearImage()">
                      <i class="bi bi-trash"></i> Remove
                    </button>
                  </div>
                </div>
                
                <!-- Submit Button -->
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary btn-lg btn-hover">
                    <i class="bi bi-plus-circle me-2"></i> Post Service
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer-custom py-5 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4 mb-md-0">
          <h5 class="fw-bold mb-3">
            <i class="bi bi-cash-coin"></i> Student Sphere
          </h5>
          <p class="text-white-50">Empowering South African students to monetize their skills and connect with their campus community.</p>
        </div>
        <div class="col-md-4 mb-4 mb-md-0">
          <h5 class="fw-bold mb-3">Quick Links</h5>
          <ul class="list-unstyled">
            <li><a href="browse.html" class="text-white-50 text-decoration-none">Browse Services</a></li>
            <li><a href="create-service.html" class="text-white-50 text-decoration-none">Post a Service</a></li>
            <li><a href="login.html" class="text-white-50 text-decoration-none">Login</a></li>
            <li><a href="signup.html" class="text-white-50 text-decoration-none">Sign Up</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5 class="fw-bold mb-3">Connect</h5>
          <div class="d-flex gap-3">
            <a href="#" class="text-white fs-4"><i class="bi bi-facebook"></i></a>
            <a href="#" class="text-white fs-4"><i class="bi bi-twitter"></i></a>
            <a href="#" class="text-white fs-4"><i class="bi bi-instagram"></i></a>
            <a href="#" class="text-white fs-4"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
      <hr class="my-4 bg-white opacity-25">
      <div class="text-center text-white-50">
        <p class="mb-0">&copy; 2024 Student Sphere. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Bootstrap 5.3 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Custom JavaScript -->
  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/services.js"></script>
  <script src="js/auth.js"></script>
  
  <!-- Page-specific JavaScript -->
  <script>
    let uploadedImage = null;
    
    // Populate university dropdown
    function populateUniversities() {
      const select = document.getElementById('university');
      universities.forEach(uni => {
        const option = document.createElement('option');
        option.value = uni;
        option.textContent = uni;
        select.appendChild(option);
      });
    }
    
    // Handle image upload
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validate file size (10MB max)
      if (file.size > 10 * 1024 * 1024) {
        showToast('Image size must be less than 10MB', 'error');
        return;
      }
      
      // Validate file type
      if (!file.type.startsWith('image/')) {
        showToast('Please upload an image file', 'error');
        return;
      }
      
      uploadedImage = file;
      
      // Show preview
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('previewImg').src = e.target.result;
        document.getElementById('imagePreview').style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
    
    // Clear uploaded image
    function clearImage() {
      uploadedImage = null;
      document.getElementById('image').value = '';
      document.getElementById('imagePreview').style.display = 'none';
    }
    
    // Handle form submission
    function handleCreateService(event) {
      event.preventDefault();
      
      // Get form values
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const category = document.getElementById('category').value;
      const price = document.getElementById('price').value;
      const university = document.getElementById('university').value;
      const phone = document.getElementById('phone').value;
      
      // Get selected payment methods
      const paymentMethods = [];
      if (document.getElementById('paymentCash').checked) paymentMethods.push('Cash');
      if (document.getElementById('paymentEFT').checked) paymentMethods.push('EFT');
      if (document.getElementById('paymentCard').checked) paymentMethods.push('Card');
      
      // Validate payment methods
      if (paymentMethods.length === 0) {
        showToast('Please select at least one payment method', 'error');
        return;
      }
      
      // Validate image
      if (!uploadedImage) {
        showToast('Please upload a service image', 'error');
        return;
      }
      
      // Create service object
      const serviceData = {
        title,
        description,
        category,
        price: parseFloat(price),
        university,
        phone: '27' + phone,
        paymentMethods,
        image: uploadedImage
      };
      
      console.log('Service created:', serviceData);
      
      // Show success message
      showToast('Service posted successfully! Your service is now live.', 'success');
      
      // Reset form
      document.getElementById('createServiceForm').reset();
      clearImage();
      
      // Redirect to browse page after 2 seconds
      setTimeout(() => {
        window.location.href = 'browse.html';
      }, 2000);
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      populateUniversities();
      updateNavbarAuth();
    });
  </script>
</body>
</html>
